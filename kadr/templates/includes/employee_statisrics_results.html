<!-- Статистика сотрудника -->
{% for stat in employee_stats %}
<div class="row mb-4">
    <!-- Карточки статистики -->
    <div class="col-md-3">
        <div class="card text-center bg-success text-white">
            <div class="card-body">
                <h5 class="card-title">{{ stat.total_working_days }}</h5>
                <p class="card-text">Рабочих дней</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center bg-info text-white">
            <div class="card-body">
                <h5 class="card-title">{{ stat.attendances.count }}</h5>
                <p class="card-text">Заполнено дней</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center bg-warning text-dark">
            <div class="card-body">
                <h5 class="card-title">{{ stat.status_counts.full|default:0 }}</h5>
                <p class="card-text">Полных дней</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center bg-danger text-white">
            <div class="card-body">
                <h5 class="card-title">{{ stat.status_counts.sick|default:0 }}</h5>
                <p class="card-text">Больничных</p>
            </div>
        </div>
    </div>
</div>

<!-- Детальная статистика -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">Детальная статистика</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <table class="table table-sm">
                    <tr>
                        <td><span class="badge bg-success">●</span> Полный день:</td>
                        <td><strong>{{ stat.status_counts.full|default:0 }}</strong></td>
                        <td>дней</td>
                    </tr>
                    <tr>
                        <td><span class="badge bg-warning">●</span> Пол дня:</td>
                        <td><strong>{{ stat.status_counts.half|default:0 }}</strong></td>
                        <td>дней</td>
                    </tr>
                    <tr>
                        <td><span class="badge bg-info">●</span> Отпуск:</td>
                        <td><strong>{{ stat.status_counts.vacation|default:0 }}</strong></td>
                        <td>дней</td>
                    </tr>
                    <tr>
                        <td><span class="badge bg-danger">●</span> Больничный:</td>
                        <td><strong>{{ stat.status_counts.sick|default:0 }}</strong></td>
                        <td>дней</td>
                    </tr>
                    <tr class="table-secondary">
                        <td><strong>Пропущено дней:</strong></td>
                        <td><strong>{{ stat.missing_days }}</strong></td>
                        <td>дней</td>
                    </tr>
                </table>
            </div>
            <div class="col-md-6">
                <div class="text-center">
                    <h6>Процент присутствия</h6>
                    <div class="progress mb-2" style="height: 30px;">
                        <div class="progress-bar 
                            {% if stat.attendance_percentage >= 90 %}bg-success
                            {% elif stat.attendance_percentage >= 70 %}bg-warning
                            {% else %}bg-danger{% endif %}" 
                            style="width: {{ stat.attendance_percentage }}%">
                            <strong>{{ stat.attendance_percentage|floatformat:1 }}%</strong>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        {% if stat.attendance_percentage >= 90 %}
                            <span class="badge bg-success fs-6">Отлично</span>
                        {% elif stat.attendance_percentage >= 70 %}
                            <span class="badge bg-warning text-dark fs-6">Удовлетворительно</span>
                        {% else %}
                            <span class="badge bg-danger fs-6">Нужно улучшить</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- История посещаемости -->
<div class="card">
    <div class="card-header bg-light">
        <h5 class="mb-0">История посещаемости</h5>
    </div>
    <div class="card-body">
        {% if stat.attendances %}
        <div class="table-responsive">
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th>Дата</th>
                        <th>Статус</th>
                        <th>День недели</th>
                        <th>Тип дня</th>
                    </tr>
                </thead>
                <tbody>
                    {% for attendance in stat.attendances %}
                    <tr>
                        <td>{{ attendance.date|date:"d.m.Y" }}</td>
                        <td>
                            {% if attendance.status == 'full' %}
                                <span class="badge bg-success">Полный день</span>
                            {% elif attendance.status == 'half' %}
                                <span class="badge bg-warning text-dark">Пол дня</span>
                            {% elif attendance.status == 'vacation' %}
                                <span class="badge bg-info">Отпуск</span>
                            {% elif attendance.status == 'sick' %}
                                <span class="badge bg-danger">Больничный</span>
                            {% else %}
                                <span class="badge bg-secondary">Не указан</span>
                            {% endif %}
                        </td>
                        <td>
                            {{ attendance.date|date:"l" }}
                            {% if attendance.date == today %}
                                <span class="badge bg-primary">Сегодня</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if RussianHolidays.is_working_day(attendance.date) %}
                                <span class="badge bg-success">Рабочий</span>
                            {% else %}
                                <span class="badge bg-secondary">Выходной</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted text-center">Нет данных о посещаемости за выбранный период</p>
        {% endif %}
    </div>
</div>
{% endfor %}